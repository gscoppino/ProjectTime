{% extends 'project/base_nav.html' %}
{% load static %}


{% block title %}ProjectTime | Dashboard{% endblock %}

{% block styles %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'project/dashboard.css' %}">
{% endblock %}

{% block content %}
{{ block.super }}
<div class="container is-fluid mt-3">
    <main class="mt-4">
        {% if timezone_form %}
        <article class="message is-warning">
            <div class="message-header">
                <p>Select Timezone</p>
            </div>
            <div class="message-body">
                <p>Please select a timezone.</p>
                <form class="mt-2" method="post" action="{% url 'admin:select-timezone' %}">
                    {% csrf_token %}
                    <div class="field is-horizontal">
                        <div class="field-body">
                            <div class="field is-narrow">
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="timezone">
                                            {% for k, v in timezone_form.fields.timezone.choices %}
                                            <option value="{{ k }}" {% if k == timezone_form.fields.timezone.initial %}selected{% endif %}>{{ v }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <div class="control">
                                    <button type="submit" class="button is-primary">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </article>
        {% endif %}
        <div class="columns is-desktop">
            <section class="column is-narrow">
                <section class="panel is-info">
                    <header class="panel-heading">
                        <div class="is-flex is-flex-direction-row is-align-items-center">
                            <p>Active Projects</p>
                            <div class="is-flex-grow-1"></div>
                            <a class="ml-4 button is-link is-light" href="{% url 'project:project-create' %}">+ Create Project</a>
                        </div>
                    </header>
                    <div class="panel-block">
                        <div class="table-container table-height" style="width: 100%;">
                            <table class="table is-bordered is-striped is-hoverable is-fullwidth">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Last Charge</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for project in active_projects %}
                                    <tr>
                                        <td>{{ project.name }}</td>
                                        <td>{{ project.db__latest_charge }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                <section class="panel is-info">
                    <header class="panel-heading">
                        <div class="is-flex is-flex-direction-row is-align-items-center">
                            <p>Current Month Summary</p>
                        </div>
                    </header>
                    <div class="panel-block">
                        {{ month_summary_chart_div | safe }}
                        <script type="text/javascript" src="{% static 'project/vendor/bokeh.min.js' %}"></script>
                        {{ month_summary_chart_script | safe }}
                    </div>
                </section>
            </section>
            <section class="column">
                <section class="panel is-info">
                    <header class="panel-heading">
                        <div class="is-flex is-flex-direction-row is-align-items-center">
                            <p>Open Charges</p>
                            <div class="is-flex-grow-1"></div>
                            <a class="ml-4 button is-link is-light" href="{% url 'admin:project_charge_add' %}">+ Create Charge</a>
                        </div>
                    </header>
                    <div class="panel-block">
                        <div class="table-container table-height" style="width: 100%">
                            <table class="table is-bordered is-striped is-hoverable is-fullwidth">
                                <thead>
                                    <tr>
                                        <th>Project</th>
                                        <th>Start</th>
                                        <th>End</th>
                                        <th>Time Charged</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for charge in open_charges %}
                                    <tr>
                                        <td>{{ charge.project.name }}</td>
                                        <td>{{ charge.start_time }}</td>
                                        <td>{{ charge.end_time }}</td>
                                        <td>{{ charge.db__time_charged }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                <div class="columns">
                    <div class="column">
                        <section class="panel is-link">
                            <header class="panel-heading">
                                <div class="is-flex is-flex-direction-row is-align-items-center">
                                    <p>Quick Charge</p>
                                </div>
                            </header>
                            <div class="panel-block">
                                <form style="width: 100%;" method="post">
                                    {% csrf_token %}
                                    <div class="field">
                                        <label class="label">Project Name</label>
                                        <div class="control">
                                            <datalist id="project-list">
                                                {% for project in active_projects %}
                                                <option value="{{ project.name }}">
                                                    Last Charge: {{ project.db__latest_charge }}
                                                </option>
                                                {% endfor %}
                                            </datalist>
                                            <input list="project-list" class="input" type="input">
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label">Date</label>
                                        <div class="control">
                                            <input class="input" type="date">
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label">Start Time</label>
                                        <div class="control">
                                            <input class="input" type="time">
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label">End Time</label>
                                        <div class="control">
                                            <input class="input" type="time">
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="checkbox">
                                            <input type="checkbox">
                                            Closed
                                        </label>
                                    </div>
                                    <div class="field">
                                        <div class="control">
                                            <button type="submit" class="button is-link">Submit</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </section>
                    </div>
                </div>
            </section>
        </div>
    </main>
</div>
{% endblock %}
